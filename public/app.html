<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PageForge — AI SEO Page Generator</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Geist:wght@300;400;500;600;700&family=Geist+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #fafafa;
    --surface: #ffffff;
    --border: #e5e7eb;
    --border-focus: #111;
    --text: #111;
    --muted: #6b7280;
    --subtle: #9ca3af;
    --accent: #111;
    --accent-hover: #333;
    --success: #16a34a;
    --error: #dc2626;
    --warning: #d97706;
    --chip-bg: #f3f4f6;
    --chip-active: #111;
    --step-line: #e5e7eb;
    --mono: 'Geist Mono', monospace;
    --sans: 'Geist', -apple-system, sans-serif;
    --radius: 10px;
    --radius-sm: 6px;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: var(--sans);
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
  }

  /* ─── TOPBAR ─── */
  .topbar {
    position: fixed;
    top: 0; left: 0; right: 0;
    height: 56px;
    background: rgba(255,255,255,0.9);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    padding: 0 24px;
    z-index: 100;
    gap: 16px;
  }

  .logo {
    font-size: 15px;
    font-weight: 700;
    letter-spacing: -0.5px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .logo-mark {
    width: 26px; height: 26px;
    background: #111;
    border-radius: 6px;
    display: flex; align-items: center; justify-content: center;
    color: white;
    font-size: 13px;
  }

  .topbar-right {
    margin-left: auto;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .badge {
    font-size: 11px;
    font-family: var(--mono);
    background: var(--chip-bg);
    color: var(--muted);
    padding: 3px 8px;
    border-radius: 20px;
    border: 1px solid var(--border);
  }

  .badge.success { background: #f0fdf4; color: var(--success); border-color: #bbf7d0; }
  .badge.error { background: #fef2f2; color: var(--error); border-color: #fecaca; }

  /* ─── MAIN LAYOUT ─── */
  .main {
    max-width: 640px;
    margin: 0 auto;
    padding: 88px 24px 80px;
  }

  /* ─── HERO ─── */
  .hero {
    text-align: center;
    margin-bottom: 48px;
  }

  .hero-eyebrow {
    font-family: var(--mono);
    font-size: 11px;
    color: var(--muted);
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 12px;
  }

  .hero-title {
    font-size: 32px;
    font-weight: 700;
    letter-spacing: -1px;
    line-height: 1.1;
    margin-bottom: 12px;
  }

  .hero-sub {
    font-size: 15px;
    color: var(--muted);
    line-height: 1.6;
  }

  /* ─── STEP FLOW ─── */
  .steps-container {
    display: flex;
    flex-direction: column;
    gap: 0;
  }

  .step {
    display: flex;
    gap: 0;
    position: relative;
  }

  .step-left {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 40px;
    flex-shrink: 0;
  }

  .step-circle {
    width: 32px; height: 32px;
    border-radius: 50%;
    border: 1.5px solid var(--border);
    background: var(--surface);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: 600;
    color: var(--muted);
    flex-shrink: 0;
    transition: all 0.2s;
    position: relative;
    z-index: 1;
  }

  .step.active .step-circle {
    border-color: var(--accent);
    background: var(--accent);
    color: white;
  }

  .step.done .step-circle {
    border-color: var(--success);
    background: #f0fdf4;
    color: var(--success);
  }

  .step-line {
    width: 1.5px;
    flex: 1;
    background: var(--step-line);
    margin: 4px 0;
    min-height: 24px;
  }

  .step.active .step-line,
  .step.done .step-line {
    background: var(--border);
  }

  .step-right {
    flex: 1;
    padding: 4px 0 36px 16px;
  }

  .step-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 4px;
    height: 32px;
    cursor: pointer;
  }

  .step-title {
    font-size: 14px;
    font-weight: 600;
    color: var(--muted);
    transition: color 0.2s;
  }

  .step.active .step-title { color: var(--text); }
  .step.done .step-title { color: var(--text); }

  .step-subtitle {
    font-size: 12px;
    color: var(--subtle);
    margin-bottom: 20px;
    line-height: 1.5;
  }

  .step-content {
    display: none;
  }

  .step.active .step-content {
    display: block;
  }

  .step-summary {
    display: none;
    font-size: 12px;
    color: var(--muted);
    margin-top: 2px;
    font-family: var(--mono);
  }

  .step.done .step-summary {
    display: block;
  }

  /* ─── FORM ELEMENTS ─── */
  .field {
    margin-bottom: 16px;
  }

  .field:last-child { margin-bottom: 0; }

  label {
    display: block;
    font-size: 13px;
    font-weight: 500;
    margin-bottom: 6px;
    color: var(--text);
  }

  .label-hint {
    font-weight: 400;
    color: var(--muted);
    font-size: 12px;
  }

  input[type="text"],
  input[type="password"],
  textarea,
  select {
    width: 100%;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    color: var(--text);
    font-family: var(--sans);
    font-size: 14px;
    padding: 10px 12px;
    outline: none;
    transition: border-color 0.15s, box-shadow 0.15s;
    -webkit-appearance: none;
  }

  input[type="text"]:focus,
  input[type="password"]:focus,
  textarea:focus,
  select:focus {
    border-color: var(--border-focus);
    box-shadow: 0 0 0 3px rgba(0,0,0,0.06);
  }

  textarea {
    resize: vertical;
    min-height: 80px;
    line-height: 1.6;
  }

  select {
    cursor: pointer;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236b7280' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 12px center;
    padding-right: 36px;
  }

  .hint-text {
    font-size: 12px;
    color: var(--muted);
    margin-top: 6px;
    line-height: 1.5;
  }

  .char-counter {
    font-size: 11px;
    font-family: var(--mono);
    margin-top: 5px;
    color: var(--muted);
  }

  .char-counter .count { font-weight: 600; }
  .char-counter .count.good { color: var(--success); }
  .char-counter .count.warn { color: var(--warning); }
  .char-counter .count.bad { color: var(--error); }

  /* ─── CHIPS ─── */
  .chip-group {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }

  .chip {
    font-size: 12px;
    font-family: var(--mono);
    padding: 5px 10px;
    border-radius: 20px;
    border: 1px solid var(--border);
    background: var(--chip-bg);
    color: var(--muted);
    cursor: pointer;
    transition: all 0.15s;
    user-select: none;
  }

  .chip:hover { border-color: #999; color: var(--text); }

  .chip.active {
    background: var(--chip-active);
    color: white;
    border-color: var(--chip-active);
  }

  /* keyword tag input */
  .keyword-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 8px;
    min-height: 46px;
    background: var(--surface);
    cursor: text;
    transition: border-color 0.15s, box-shadow 0.15s;
  }

  .keyword-tags:focus-within {
    border-color: var(--border-focus);
    box-shadow: 0 0 0 3px rgba(0,0,0,0.06);
  }

  .kw-tag {
    display: flex;
    align-items: center;
    gap: 4px;
    background: var(--chip-bg);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 2px 8px;
    font-size: 12px;
    font-family: var(--mono);
    color: var(--text);
  }

  .kw-tag-remove {
    cursor: pointer;
    color: var(--subtle);
    font-size: 13px;
    line-height: 1;
    transition: color 0.1s;
  }

  .kw-tag-remove:hover { color: var(--error); }

  .kw-input {
    border: none;
    outline: none;
    font-size: 13px;
    font-family: var(--sans);
    min-width: 100px;
    flex: 1;
    background: transparent;
    color: var(--text);
  }

  /* slider */
  .slider-wrap {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  input[type="range"] {
    flex: 1;
    accent-color: var(--accent);
    cursor: pointer;
    height: 4px;
  }

  .slider-value {
    font-family: var(--mono);
    font-size: 13px;
    font-weight: 600;
    color: var(--text);
    min-width: 70px;
    text-align: right;
  }

  /* ─── BUTTONS ─── */
  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 7px;
    padding: 10px 18px;
    border-radius: var(--radius-sm);
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    border: 1px solid transparent;
    transition: all 0.15s;
    font-family: var(--sans);
    text-decoration: none;
    white-space: nowrap;
  }

  .btn-primary {
    background: var(--text);
    color: white;
    border-color: var(--text);
    width: 100%;
    padding: 12px;
    font-size: 14px;
  }

  .btn-primary:hover { background: #333; border-color: #333; }
  .btn-primary:active { transform: scale(0.99); }
  .btn-primary:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

  .btn-secondary {
    background: var(--surface);
    color: var(--text);
    border-color: var(--border);
  }

  .btn-secondary:hover { border-color: #999; }

  .btn-sm {
    padding: 7px 14px;
    font-size: 13px;
  }

  .btn-row {
    display: flex;
    gap: 8px;
    margin-top: 16px;
  }

  .btn-row .btn { flex: 1; }

  /* ─── STEP NAVIGATION ─── */
  .step-nav {
    margin-top: 20px;
  }

  /* ─── LOADING STATE ─── */
  .loading-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(4px);
    z-index: 200;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 0;
  }

  .loading-overlay.active {
    display: flex;
  }

  .loading-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 40px;
    width: 480px;
    max-width: 90vw;
    box-shadow: 0 20px 60px rgba(0,0,0,0.08);
  }

  .loading-top {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 28px;
  }

  .loading-spinner {
    width: 40px; height: 40px;
    border: 2px solid var(--border);
    border-top-color: var(--text);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    flex-shrink: 0;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  .loading-title-wrap {}
  .loading-title { font-size: 16px; font-weight: 600; }
  .loading-kw { font-size: 12px; color: var(--muted); margin-top: 2px; font-family: var(--mono); }

  .progress-bar-track {
    height: 3px;
    background: var(--border);
    border-radius: 99px;
    overflow: hidden;
    margin-bottom: 24px;
  }

  .progress-bar-fill {
    height: 100%;
    background: var(--text);
    border-radius: 99px;
    transition: width 0.6s ease;
    width: 0%;
  }

  .loading-steps { display: flex; flex-direction: column; gap: 0; }

  .lstep {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 10px 0;
    border-bottom: 1px solid var(--border);
    opacity: 0.4;
    transition: opacity 0.3s;
  }

  .lstep:last-child { border-bottom: none; }

  .lstep.active { opacity: 1; }
  .lstep.done { opacity: 0.7; }

  .lstep-dot {
    width: 20px; height: 20px;
    border-radius: 50%;
    border: 1.5px solid var(--border);
    display: flex; align-items: center; justify-content: center;
    font-size: 9px;
    flex-shrink: 0;
    margin-top: 1px;
    transition: all 0.3s;
  }

  .lstep.active .lstep-dot {
    border-color: var(--text);
    background: var(--text);
  }

  .lstep.active .lstep-dot::after {
    content: '';
    width: 6px; height: 6px;
    background: white;
    border-radius: 50%;
    animation: blink 1s ease infinite;
  }

  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
  }

  .lstep.done .lstep-dot {
    border-color: var(--success);
    background: var(--success);
    color: white;
  }

  .lstep.done .lstep-dot::after {
    content: '✓';
    font-size: 10px;
    font-weight: 700;
    color: white;
  }

  .lstep-label { font-size: 13px; font-weight: 500; }
  .lstep-sub { font-size: 11px; color: var(--muted); margin-top: 1px; font-family: var(--mono); }

  .loading-footer {
    margin-top: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 11px;
    color: var(--subtle);
    font-family: var(--mono);
  }

  /* ─── RESULT CARD ─── */
  .result-section {
    display: none;
  }

  .result-section.visible { display: block; }

  .result-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
    margin-top: 32px;
  }

  .result-header {
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
  }

  .result-title {
    font-size: 14px;
    font-weight: 600;
  }

  .result-tabs {
    display: flex;
    border-bottom: 1px solid var(--border);
    padding: 0 20px;
  }

  .rtab {
    padding: 10px 14px;
    font-size: 12px;
    font-weight: 500;
    color: var(--muted);
    cursor: pointer;
    border: none;
    background: none;
    border-bottom: 2px solid transparent;
    transition: all 0.15s;
    font-family: var(--sans);
    margin-bottom: -1px;
  }

  .rtab:hover { color: var(--text); }
  .rtab.active { color: var(--text); border-bottom-color: var(--text); }

  .rtab-panel { display: none; }
  .rtab-panel.active { display: block; }

  .preview-browser {
    background: #f5f5f5;
    padding: 10px 16px;
    display: flex;
    align-items: center;
    gap: 8px;
    border-bottom: 1px solid var(--border);
  }

  .browser-dots {
    display: flex; gap: 5px;
  }

  .bdot {
    width: 10px; height: 10px;
    border-radius: 50%;
  }

  .url-pill {
    flex: 1;
    background: white;
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 4px 10px;
    font-size: 11px;
    font-family: var(--mono);
    color: var(--muted);
  }

  iframe#previewFrame {
    width: 100%;
    height: 480px;
    border: none;
    display: block;
    background: white;
  }

  .score-panel { padding: 20px; }

  .score-big {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 20px;
    padding: 20px;
    background: var(--bg);
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
  }

  .score-ring-wrap {
    position: relative;
    width: 72px; height: 72px;
    flex-shrink: 0;
  }

  .score-ring-wrap svg { transform: rotate(-90deg); }

  .score-ring-center {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: var(--mono);
    font-size: 18px;
    font-weight: 700;
  }

  .score-info {}
  .score-label { font-size: 18px; font-weight: 700; }
  .score-sublabel { font-size: 12px; color: var(--muted); margin-top: 2px; }

  .rules-list { display: flex; flex-direction: column; gap: 1px; }

  .rule-row {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 7px 0;
    font-size: 12px;
    color: var(--muted);
    border-bottom: 1px solid var(--border);
  }

  .rule-row:last-child { border-bottom: none; }

  .rule-dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    background: var(--border);
    flex-shrink: 0;
  }

  .rule-row.pass { color: var(--text); }
  .rule-row.pass .rule-dot { background: var(--success); }
  .rule-row.fail .rule-dot { background: var(--error); }
  .rule-row.fail { color: var(--muted); }

  .code-panel { position: relative; }

  .code-toolbar {
    padding: 10px 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid var(--border);
    background: var(--bg);
  }

  .code-label { font-size: 11px; color: var(--muted); font-family: var(--mono); }

  pre {
    margin: 0;
    padding: 20px;
    font-family: var(--mono);
    font-size: 11px;
    line-height: 1.7;
    color: #374151;
    max-height: 400px;
    overflow: auto;
    white-space: pre-wrap;
    word-break: break-all;
    background: var(--bg);
  }

  /* ─── TOAST ─── */
  .toast {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%) translateY(80px);
    background: var(--text);
    color: white;
    padding: 10px 18px;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 500;
    z-index: 999;
    transition: transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
    white-space: nowrap;
    box-shadow: 0 8px 30px rgba(0,0,0,0.15);
  }

  .toast.show { transform: translateX(-50%) translateY(0); }
  .toast.error { background: var(--error); }
  .toast.success { background: var(--success); }

  hr.field-divider {
    border: none;
    border-top: 1px solid var(--border);
    margin: 20px 0;
  }

  .step-edit-btn {
    font-size: 11px;
    color: var(--muted);
    cursor: pointer;
    padding: 2px 6px;
    border-radius: 4px;
    background: var(--chip-bg);
    border: 1px solid var(--border);
    font-family: var(--mono);
    transition: all 0.1s;
    margin-left: auto;
    display: none;
  }

  .step.done .step-edit-btn { display: inline-flex; align-items: center; }
  .step-edit-btn:hover { border-color: #999; color: var(--text); }

  .two-col {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }

  .step:last-child .step-right {
    padding-bottom: 0;
  }

  .step:last-child .step-line {
    display: none;
  }
</style>
</head>
<body>

<!-- TOPBAR -->
<div class="topbar">
  <div class="logo">
    <div class="logo-mark">⚡</div>
    PageForge
  </div>
  <div class="topbar-right" id="topbarRight">
    <a href="/dashboard" style="font-size:13px;color:var(--muted);text-decoration:none;padding:6px 10px;border:1px solid var(--border);border-radius:6px;background:#fff;">← Dashboard</a>
    <button onclick="signOut()" style="font-size:13px;color:var(--muted);background:none;border:none;cursor:pointer;padding:6px;">Sign out</button>
  </div>
</div>

<!-- LOADING OVERLAY -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-card">
    <div class="loading-top">
      <div class="loading-spinner"></div>
      <div class="loading-title-wrap">
        <div class="loading-title">Generating your SEO page</div>
        <div class="loading-kw" id="loadingKw">Powered by Claude AI</div>
      </div>
    </div>

    <div class="progress-bar-track">
      <div class="progress-bar-fill" id="progressFill"></div>
    </div>

    <div class="loading-steps">
      <div class="lstep" id="ls1">
        <div class="lstep-dot"></div>
        <div>
          <div class="lstep-label">Analyzing keyword strategy</div>
          <div class="lstep-sub">focus & semantic keyword mapping</div>
        </div>
      </div>
      <div class="lstep" id="ls2">
        <div class="lstep-dot"></div>
        <div>
          <div class="lstep-label">Generating SEO content</div>
          <div class="lstep-sub">writing body copy & headings</div>
        </div>
      </div>
      <div class="lstep" id="ls3">
        <div class="lstep-dot"></div>
        <div>
          <div class="lstep-label">Building schema markup</div>
          <div class="lstep-sub">JSON-LD, FAQ & BreadcrumbList</div>
        </div>
      </div>
      <div class="lstep" id="ls4">
        <div class="lstep-dot"></div>
        <div>
          <div class="lstep-label">Applying 20 SEO rules</div>
          <div class="lstep-sub">meta tags, OG, Twitter Card, alts</div>
        </div>
      </div>
      <div class="lstep" id="ls5">
        <div class="lstep-dot"></div>
        <div>
          <div class="lstep-label">Finalizing design & CSS</div>
          <div class="lstep-sub">responsive layout, mobile styles</div>
        </div>
      </div>
    </div>

    <div class="loading-footer">
      <span id="loadingStep">Starting up...</span>
      <span id="loadingTimer">0s</span>
    </div>
  </div>
</div>

<!-- MAIN -->
<div class="main">

  <!-- HERO -->
  <div class="hero">
    <div class="hero-eyebrow">Powered by Claude AI</div>
    <h1 class="hero-title">SEO-optimized pages,<br>in seconds.</h1>
    <p class="hero-sub">Generate WordPress-ready HTML with full SEO optimization — schema markup, meta tags, and 20-point SEO scoring.</p>
  </div>

  <!-- STEPS -->
  <div class="steps-container">

    <!-- STEP 1: Keyword & Type -->
    <div class="step active" id="step1">
      <div class="step-left">
        <div class="step-circle">1</div>
        <div class="step-line"></div>
      </div>
      <div class="step-right">
        <div class="step-header" onclick="editStep(1)">
          <div class="step-title">Define your target keywords</div>
          <span class="step-edit-btn">Edit</span>
        </div>
        <div class="step-summary" id="summary1"></div>
        <div class="step-content">
          <div class="step-subtitle">Your primary keyword drives all SEO optimization decisions.</div>
          <div class="field">
            <label>Focus Keyword <span class="label-hint">— the main term you want to rank for</span></label>
            <input type="text" id="focusKeyword" placeholder="e.g. CBD oil benefits" oninput="updateFocusKw()">
          </div>
          <div class="field">
            <label>Secondary Keywords <span class="label-hint">— press Enter or comma to add</span></label>
            <div class="keyword-tags" id="kwTags" onclick="document.getElementById('kwInput').focus()">
              <input type="text" class="kw-input" id="kwInput" placeholder="Add related keywords...">
            </div>
          </div>
          <div class="field">
            <label>Page Type</label>
            <select id="pageType">
              <option value="pillar">Pillar / Educational Article</option>
              <option value="product">Product Page</option>
              <option value="landing">Landing Page</option>
              <option value="blog">Blog Post</option>
              <option value="local">Local Business Page</option>
              <option value="faq">FAQ Page</option>
              <option value="comparison">Comparison Page</option>
            </select>
          </div>
          <div class="step-nav">
            <button class="btn btn-primary" onclick="completeStep1()">Continue →</button>
          </div>
        </div>
      </div>
    </div>

    <!-- STEP 2: Page details -->
    <div class="step" id="step2">
      <div class="step-left">
        <div class="step-circle">2</div>
        <div class="step-line"></div>
      </div>
      <div class="step-right">
        <div class="step-header" onclick="editStep(2)">
          <div class="step-title">Page details & settings</div>
          <span class="step-edit-btn">Edit</span>
        </div>
        <div class="step-summary" id="summary2"></div>
        <div class="step-content">
          <div class="step-subtitle">Configure how your page should be generated.</div>
          <div class="two-col">
            <div class="field">
              <label>Site Name</label>
              <input type="text" id="siteName" placeholder="My Website">
            </div>
            <div class="field">
              <label>Content Tone</label>
              <select id="tone">
                <option value="professional">Professional</option>
                <option value="friendly">Friendly</option>
                <option value="medical">Medical / Clinical</option>
                <option value="technical">Technical</option>
                <option value="marketing">Marketing</option>
              </select>
            </div>
          </div>
          <div class="field">
            <label>Page Title <span class="label-hint">— 50–65 chars ideal</span></label>
            <input type="text" id="pageTitle" placeholder="e.g. CBD Oil Benefits: Complete Guide | My Site" oninput="updateTitleCount()">
            <div class="char-counter">
              <span class="count" id="titleCount">0</span> chars
              <span style="color:var(--muted);"> · ideal 50–65</span>
            </div>
          </div>
          <div class="field">
            <label>Target URL</label>
            <input type="text" id="targetUrl" placeholder="https://example.com/my-page/">
          </div>
          <div class="field">
            <label>Target Word Count</label>
            <div class="slider-wrap">
              <input type="range" id="wordCount" min="300" max="5000" step="100" value="1000" oninput="updateWC()">
              <span class="slider-value" id="wcDisplay">1,000 words</span>
            </div>
            <div class="hint-text" id="wcHint">Good for most blog posts and landing pages.</div>
          </div>
          <div class="field">
            <label>Schema Markup Types</label>
            <div class="chip-group" id="schemaChips">
              <div class="chip active" data-schema="Article">Article</div>
              <div class="chip active" data-schema="FAQPage">FAQ</div>
              <div class="chip active" data-schema="BreadcrumbList">Breadcrumb</div>
              <div class="chip" data-schema="HowTo">HowTo</div>
              <div class="chip" data-schema="Product">Product</div>
              <div class="chip" data-schema="LocalBusiness">LocalBusiness</div>
              <div class="chip" data-schema="Review">Review</div>
            </div>
          </div>
          <div class="step-nav">
            <button class="btn btn-primary" onclick="completeStep2()">Continue →</button>
          </div>
        </div>
      </div>
    </div>

    <!-- STEP 3: Generate -->
    <div class="step" id="step3">
      <div class="step-left">
        <div class="step-circle">3</div>
      </div>
      <div class="step-right">
        <div class="step-header">
          <div class="step-title">Generate your page</div>
        </div>
        <div class="step-content">
          <div class="step-subtitle">Review your configuration, then generate. Claude will build a fully SEO-optimized, WordPress-ready HTML page.</div>

          <div id="configSummary" style="background:var(--bg);border:1px solid var(--border);border-radius:var(--radius-sm);padding:16px;margin-bottom:20px;font-size:13px;line-height:2;">
          </div>

          <button class="btn btn-primary" onclick="generatePage()" id="generateBtn" style="font-size:15px;padding:14px;">
            ⚡ Generate SEO Page
          </button>
        </div>
      </div>
    </div>

  </div>

  <!-- RESULT -->
  <div class="result-section" id="resultSection">
    <div class="result-card">
      <div class="result-header">
        <div class="result-title">Generated Page</div>
        <div style="display:flex;gap:8px;align-items:center;">
          <span style="font-size:12px;color:var(--muted);font-family:var(--mono);" id="seoScoreBadge"></span>
          <button class="btn btn-secondary btn-sm" onclick="downloadPage()">⬇ Download</button>
          <button class="btn btn-secondary btn-sm" onclick="copyCode()">⎘ Copy</button>
        </div>
      </div>

      <div class="result-tabs">
        <button class="rtab active" onclick="switchRTab('preview', this)">Preview</button>
        <button class="rtab" onclick="switchRTab('score', this)">SEO Score</button>
        <button class="rtab" onclick="switchRTab('code', this)">Code</button>
      </div>

      <!-- Preview -->
      <div class="rtab-panel active" id="rp-preview">
        <div class="preview-browser">
          <div class="browser-dots">
            <div class="bdot" style="background:#ff5f57"></div>
            <div class="bdot" style="background:#ffbd2e"></div>
            <div class="bdot" style="background:#28c840"></div>
          </div>
          <div class="url-pill" id="previewUrl">about:blank</div>
          <button class="btn btn-secondary btn-sm" style="padding:4px 10px;font-size:11px;" onclick="openInNew()">↗</button>
        </div>
        <iframe id="previewFrame"></iframe>
      </div>

      <!-- SEO Score -->
      <div class="rtab-panel" id="rp-score">
        <div class="score-panel">
          <div class="score-big">
            <div class="score-ring-wrap">
              <svg width="72" height="72" viewBox="0 0 72 72">
                <circle cx="36" cy="36" r="28" fill="none" stroke="var(--border)" stroke-width="5"/>
                <circle id="scoreCircle" cx="36" cy="36" r="28" fill="none" stroke="#111" stroke-width="5"
                  stroke-dasharray="175.9" stroke-dashoffset="175.9" stroke-linecap="round"
                  style="transition:stroke-dashoffset 1s ease, stroke 0.5s ease"/>
              </svg>
              <div class="score-ring-center" id="scoreNum">—</div>
            </div>
            <div class="score-info">
              <div class="score-label" id="scoreLabel">—</div>
              <div class="score-sublabel" id="scoreSubLabel">Generate a page to see your score</div>
            </div>
          </div>
          <div class="rules-list" id="rulesList"></div>
        </div>
      </div>

      <!-- Code -->
      <div class="rtab-panel" id="rp-code">
        <div class="code-toolbar">
          <span class="code-label" id="codeLines">0 lines</span>
          <button class="btn btn-secondary btn-sm" onclick="copyCode()">Copy</button>
        </div>
        <pre id="codeBlock"><!-- Generated code will appear here --></pre>
      </div>
    </div>
  </div>

</div>

<div class="toast" id="toast"></div>

<script>

// ─── ACCESS GUARD ───────────────────────────────────────
(function() {
  try {
    const s = JSON.parse(localStorage.getItem('pf_session') || '{}');
    if (!s.email) {
      window.location.href = '/?needsAccess=true';
    }
  } catch(e) {
    window.location.href = '/';
  }
})();

// ─── SESSION HELPERS ─────────────────────────────────────
function getSession() {
  try { return JSON.parse(localStorage.getItem('pf_session') || '{}'); } catch(e) { return {}; }
}
function signOut() {
  if (!confirm('Sign out?')) return;
  localStorage.removeItem('pf_session');
  window.location.href = '/';
}

// ─── STATE ───
let currentStep = 1;
let secKeywords = [];
let schemaTypes = ['Article', 'FAQPage', 'BreadcrumbList'];
let generatedHTML = '';

const SEO_RULES = [
  { id: 'title',       label: 'Page title tag (50–65 chars)',         check: d => d.titleLen >= 50 && d.titleLen <= 65 },
  { id: 'metaDesc',    label: 'Meta description (120–160 chars)',      check: d => d.metaLen >= 120 && d.metaLen <= 160 },
  { id: 'metaKw',      label: 'Keyword in meta description',          check: d => d.metaHasKw },
  { id: 'h1',          label: 'Single H1 tag',                        check: d => d.h1Count === 1 },
  { id: 'h1kw',        label: 'Focus keyword in H1',                  check: d => d.h1HasKw },
  { id: 'h2s',         label: 'Multiple H2 subheadings (5+)',          check: d => d.h2Count >= 5 },
  { id: 'firstPara',   label: 'Keyword in first paragraph',           check: d => d.firstParaHasKw },
  { id: 'canonical',   label: 'Canonical URL present',                check: d => d.hasCanonical },
  { id: 'schema',      label: 'JSON-LD schema markup',                check: d => d.hasSchema },
  { id: 'faqSchema',   label: 'FAQPage schema included',              check: d => d.hasFaqSchema },
  { id: 'breadcrumb',  label: 'BreadcrumbList schema',                check: d => d.hasBreadcrumb },
  { id: 'imgAlts',     label: 'All images have alt attributes',       check: d => d.imgsMissingAlt === 0 },
  { id: 'ogTags',      label: 'Open Graph tags (og:title, og:desc)',  check: d => d.hasOg },
  { id: 'twitterCard', label: 'Twitter Card tags',                    check: d => d.hasTwitter },
  { id: 'wordCount',   label: 'Content length meets target',          check: d => d.wordCount >= (window._targetWordCount || 1000) },
  { id: 'internalLinks',label: 'Internal anchor links (3+)',          check: d => d.internalLinks >= 3 },
  { id: 'faqSection',  label: 'FAQ section with 5+ Q&As',            check: d => d.faqCount >= 5 },
  { id: 'headingFlow', label: 'No skipped heading levels',           check: d => d.headingFlowOk },
  { id: 'secKeywords', label: 'Secondary keywords used',             check: d => d.secKwUsed },
  { id: 'style',       label: 'Scoped CSS styles included',          check: d => d.hasStyle },
];

// ─── STEP MANAGEMENT ───
function goToStep(n) {
  document.querySelectorAll('.step').forEach((el, i) => {
    const num = i + 1;
    el.classList.remove('active', 'done');
    if (num < n) el.classList.add('done');
    if (num === n) el.classList.add('active');
  });
  currentStep = n;
  if (n === 3) buildConfigSummary();
}

function editStep(n) {
  if (currentStep > n) goToStep(n);
}

function completeStep1() {
  const kw = document.getElementById('focusKeyword').value.trim();
  if (!kw) { showToast('error', 'Please enter a focus keyword'); return; }
  const type = document.getElementById('pageType').selectedOptions[0].text;
  const secondary = secKeywords.length ? ` + ${secKeywords.length} secondary` : '';
  document.getElementById('summary1').textContent = `"${kw}"${secondary} · ${type}`;
  goToStep(2);
}

function completeStep2() {
  const wc = document.getElementById('wordCount').value;
  const tone = document.getElementById('tone').selectedOptions[0].text;
  document.getElementById('summary2').textContent = `${parseInt(wc).toLocaleString()} words · ${tone} tone · ${schemaTypes.length} schema types`;
  goToStep(3);
}

// ─── KEYWORD TAGS ───
document.addEventListener('DOMContentLoaded', () => {
  const input = document.getElementById('kwInput');
  input.addEventListener('keydown', e => {
    if (e.key === 'Enter' || e.key === ',') {
      e.preventDefault();
      const val = input.value.replace(/,$/, '').trim();
      if (val && !secKeywords.includes(val)) {
        secKeywords.push(val);
        renderKwTags();
      }
      input.value = '';
    }
    if (e.key === 'Backspace' && !input.value && secKeywords.length) {
      secKeywords.pop();
      renderKwTags();
    }
  });

  initSchemaChips();
  renderRulesList();
  updateWC();
});

function renderKwTags() {
  const container = document.getElementById('kwTags');
  const input = document.getElementById('kwInput');
  container.innerHTML = '';
  secKeywords.forEach((kw, i) => {
    const tag = document.createElement('span');
    tag.className = 'kw-tag';
    tag.innerHTML = `${kw}<span class="kw-tag-remove" onclick="removeKw(${i})">×</span>`;
    container.appendChild(tag);
  });
  container.appendChild(input);
  input.focus();
}

function removeKw(i) {
  secKeywords.splice(i, 1);
  renderKwTags();
}

// ─── SCHEMA CHIPS ───
function initSchemaChips() {
  document.querySelectorAll('#schemaChips .chip').forEach(chip => {
    chip.addEventListener('click', () => {
      chip.classList.toggle('active');
      const s = chip.dataset.schema;
      if (chip.classList.contains('active')) {
        if (!schemaTypes.includes(s)) schemaTypes.push(s);
      } else {
        schemaTypes = schemaTypes.filter(x => x !== s);
      }
    });
  });
}

// ─── FORM HELPERS ───
function updateTitleCount() {
  const len = document.getElementById('pageTitle').value.length;
  const el = document.getElementById('titleCount');
  el.textContent = len;
  el.className = 'count ' + (len >= 50 && len <= 65 ? 'good' : len > 0 && len < 50 ? 'warn' : len > 65 ? 'bad' : '');
}

function updateWC() {
  const v = parseInt(document.getElementById('wordCount').value);
  document.getElementById('wcDisplay').textContent = v.toLocaleString() + ' words';
  const hint = v < 600 ? 'Good for quick FAQ or thin landing pages.'
    : v < 1500 ? 'Good for most blog posts and landing pages.'
    : v < 3000 ? 'Ideal for pillar pages and comprehensive guides.'
    : 'Deep-dive content for topical authority.';
  document.getElementById('wcHint').textContent = hint;
}

function updateFocusKw() {
  const kw = document.getElementById('focusKeyword').value.trim();
  if (!document.getElementById('targetUrl').value) {
    document.getElementById('targetUrl').value = kw ? `https://example.com/${kw.toLowerCase().replace(/\s+/g, '-')}/` : '';
  }
}

// ─── CONFIG SUMMARY ───
function buildConfigSummary() {
  const kw = document.getElementById('focusKeyword').value.trim();
  const type = document.getElementById('pageType').selectedOptions[0].text;
  const site = document.getElementById('siteName').value || 'My Website';
  const tone = document.getElementById('tone').selectedOptions[0].text;
  const wc = parseInt(document.getElementById('wordCount').value);
  const url = document.getElementById('targetUrl').value || `https://example.com/${kw.toLowerCase().replace(/\s+/g, '-')}/`;

  document.getElementById('configSummary').innerHTML = `
    <div style="display:grid;grid-template-columns:140px 1fr;gap:4px 12px;font-size:13px;">
      <span style="color:var(--muted);">Focus keyword</span><span style="font-weight:500;">${kw}</span>
      <span style="color:var(--muted);">Secondary</span><span>${secKeywords.length ? secKeywords.join(', ') : '—'}</span>
      <span style="color:var(--muted);">Page type</span><span>${type}</span>
      <span style="color:var(--muted);">Site name</span><span>${site}</span>
      <span style="color:var(--muted);">Tone</span><span>${tone}</span>
      <span style="color:var(--muted);">Word count</span><span>${wc.toLocaleString()}+ words</span>
      <span style="color:var(--muted);">Schema</span><span>${schemaTypes.join(', ')}</span>
      <span style="color:var(--muted);">URL</span><span style="word-break:break-all;font-family:var(--mono);font-size:11px;">${url}</span>
    </div>
  `;
}

// ─── GENERATE ───
// Now calls YOUR backend at /api/generate — API key stays on the server
async function generatePage() {
  const focusKw = document.getElementById('focusKeyword').value.trim();
  const pageType = document.getElementById('pageType').value;
  const siteName = document.getElementById('siteName').value || 'My Website';
  const pageTitle = document.getElementById('pageTitle').value.trim();
  const targetUrl = document.getElementById('targetUrl').value.trim() || `https://example.com/${focusKw.toLowerCase().replace(/\s+/g, '-')}/`;
  const tone = document.getElementById('tone').value;
  const wc = parseInt(document.getElementById('wordCount').value) || 1000;

  window._targetWordCount = wc;

  startLoading(focusKw);

  const prompt = buildPrompt(focusKw, secKeywords, pageType, siteName, targetUrl, tone, schemaTypes, pageTitle, wc);

  try {
    // ✅ Calls your backend — API key never touches the browser
    const res = await fetch('/api/generate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ prompt, wordCount: wc }),
    });

    if (!res.ok) {
      let msg = `Server error ${res.status}`;
      try { const d = await res.json(); msg = d.error || msg; } catch(e) {}
      throw new Error(msg);
    }

    const data = await res.json();
    let html = data.html?.trim() || '';

    if (!html) throw new Error('Empty response from server.');

    const fence = html.match(/^```(?:html)?\s*\n?([\s\S]*?)```\s*$/i);
    if (fence) html = fence[1].trim();

    if (html.toLowerCase().includes('<!doctype')) {
      const body = html.match(/<body[^>]*>([\s\S]*?)<\/body>/i);
      if (body) html = body[1].trim();
      else html = html.replace(/<head[\s\S]*?<\/head>/i,'').replace(/<\/?(?:html|body|head)[^>]*>/gi,'').trim();
    }

    if (!html || html.length < 200) throw new Error('Could not extract content. Try again.');

    generatedHTML = html;
    stopLoading();
    renderResult(html, focusKw, targetUrl);
    showToast('success', 'Page generated!');

  } catch(err) {
    stopLoading();
    showToast('error', err.message);
    console.error(err);
  }
}

function buildPrompt(focusKw, secKws, pageType, siteName, url, tone, schemas, pageTitle, wc) {
  const slug = focusKw.toLowerCase().replace(/\s+/g,'-');
  const title = pageTitle || (focusKw + ' | ' + siteName);
  const secList = secKws.length ? secKws.join(', ') : 'none specified';
  const schemaList = schemas.join(', ');

  return `You are an expert SEO content writer and WordPress developer. Generate WORDPRESS BODY CONTENT ONLY — no full HTML page, no <html>, no <head>, no header, no nav, no footer.

INPUTS:
- Focus Keyword: "${focusKw}"
- Page Title: "${title}"
- Secondary Keywords: ${secList}
- Page Type: ${pageType}
- Site Name: ${siteName}
- Target URL: ${url}
- Tone: ${tone}
- Target Word Count: ${wc} words minimum (HARD REQUIREMENT)
- Schema Types: ${schemaList}

OUTPUT FORMAT — WORDPRESS BODY ONLY:

SECTION 1 — SEO META COMMENT (for SEO plugin reference):
<!-- SEO META
================================================================
TITLE TAG:
${title}

META DESCRIPTION:
[Write 130-155 character description with "${focusKw}" and a CTA]

CANONICAL URL:
${url}

FOCUS KEYWORD: ${focusKw}

og:title: ${title}
og:description: [same as META DESCRIPTION]
og:url: ${url}
og:type: article
og:image: https://placehold.co/1200x630?text=${slug}

twitter:card: summary_large_image
twitter:title: ${title}
twitter:description: [same as META DESCRIPTION]
twitter:image: https://placehold.co/1200x630?text=${slug}
================================================================ -->

SECTION 2 — JSON-LD SCHEMA:
<script type="application/ld+json"> block with: ${schemaList}
Include FAQPage with 5+ real Q&As. Include BreadcrumbList (3 levels).

SECTION 3 — PAGE BODY CONTENT:
- ONE <h1> with focus keyword "${focusKw}"
- 5+ <h2> subheadings using secondary keywords
- Multiple <h3> under h2s
- Keyword "${focusKw}" in first paragraph
- ${wc}+ words of real, detailed content (NO lorem ipsum)
- EVERY <img> must have alt="[descriptive alt text with keyword]" — NEVER omit alt
- Use https://placehold.co/800x400?text=${slug} for main image
- Use https://placehold.co/600x300?text=Section for secondary images
- 3+ internal anchor links: <a href="${url}#section-id">text</a>
- FAQ section with 5+ Q&As
- DO NOT include header/nav/footer/breadcrumb UI/sidebar

STYLING:
- <style> block with .wp-seo- prefixed CSS
- Clean, professional, WordPress-theme-compatible
- FAQ accordion with vanilla JS <script> at bottom
- Mobile responsive with media queries`;
}

// ─── LOADING ───
let loadTimer = null;
let stepChain = null;
const STEPS = [
  { id: 'ls1', pct: 10, label: 'Analyzing keyword strategy...', dur: 1800 },
  { id: 'ls2', pct: 30, label: 'Generating SEO content...', dur: 3500 },
  { id: 'ls3', pct: 60, label: 'Building schema markup...', dur: 2200 },
  { id: 'ls4', pct: 80, label: 'Applying SEO rules...', dur: 2000 },
  { id: 'ls5', pct: 95, label: 'Finalizing design...', dur: 1500 },
];

function startLoading(kw) {
  document.getElementById('loadingOverlay').classList.add('active');
  document.getElementById('generateBtn').disabled = true;
  if (kw) document.getElementById('loadingKw').textContent = `"${kw}"`;

  STEPS.forEach(s => {
    const el = document.getElementById(s.id);
    if (el) el.className = 'lstep';
  });

  document.getElementById('progressFill').style.width = '0%';
  document.getElementById('loadingStep').textContent = 'Starting up...';

  const start = Date.now();
  loadTimer = setInterval(() => {
    const el = document.getElementById('loadingTimer');
    if (el) el.textContent = Math.floor((Date.now() - start) / 1000) + 's';
  }, 500);

  let i = 0;
  function run() {
    if (i >= STEPS.length) return;
    const s = STEPS[i];
    if (i > 0) {
      const prev = document.getElementById(STEPS[i-1].id);
      if (prev) prev.className = 'lstep done';
    }
    const el = document.getElementById(s.id);
    if (el) el.className = 'lstep active';
    document.getElementById('progressFill').style.width = s.pct + '%';
    document.getElementById('loadingStep').textContent = s.label;
    i++;
    stepChain = setTimeout(run, s.dur);
  }
  run();
}

function stopLoading() {
  document.getElementById('loadingOverlay').classList.remove('active');
  document.getElementById('generateBtn').disabled = false;
  clearInterval(loadTimer);
  clearTimeout(stepChain);
  document.getElementById('progressFill').style.width = '100%';
}

// ─── RENDER RESULT ───
function renderResult(html, kw, url) {
  const shell = `<!DOCTYPE html><html><head><meta charset="UTF-8"><style>body{margin:0 auto;padding:32px 40px;font-family:-apple-system,sans-serif;max-width:860px;background:#fff;color:#111;}*{box-sizing:border-box}</style></head><body>${html}</body></html>`;
  const blob = new Blob([shell], { type: 'text/html; charset=utf-8' });
  const blobUrl = URL.createObjectURL(blob);
  const frame = document.getElementById('previewFrame');
  if (frame._blobUrl) URL.revokeObjectURL(frame._blobUrl);
  frame._blobUrl = blobUrl;
  frame.src = blobUrl;
  document.getElementById('previewUrl').textContent = url;

  document.getElementById('codeBlock').textContent = html;
  document.getElementById('codeLines').textContent = html.split('\n').length + ' lines';

  const analysis = analyzeHTML(html, kw);
  renderSEOScore(analysis);

  document.getElementById('resultSection').classList.add('visible');

  setTimeout(() => {
    document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
  }, 200);
}

// ─── SEO ANALYSIS ───
function analyzeHTML(html, kw) {
  const kwLower = kw.toLowerCase();
  const h1s = [...html.matchAll(/<h1[^>]*>([\s\S]*?)<\/h1>/gi)];
  const h2s = [...html.matchAll(/<h2[^>]*>/gi)];
  const imgs = [...html.matchAll(/<img[^>]+>/gi)];
  const altMissing = imgs.filter(m => !(/alt\s*=/i.test(m[0])) || /alt\s*=\s*["']\s*["']/i.test(m[0])).length;

  const bodyText = html.replace(/<[^>]+>/g, ' ').toLowerCase();
  const firstPara = (html.match(/<p[^>]*>([\s\S]*?)<\/p>/i) || ['',''])[1].replace(/<[^>]+>/g,'').toLowerCase();

  const titleMatch = html.match(/TITLE TAG:\s*\n(.*)/i);
  const titleLen = titleMatch ? titleMatch[1].trim().length : 0;

  const metaMatch = html.match(/META DESCRIPTION:\s*\n([\s\S]*?)(?=\n\n|\nCANONICAL)/i);
  const metaText = metaMatch ? metaMatch[1].trim() : '';
  const metaLen = metaText.length;

  const headings = [...html.matchAll(/<(h[1-6])[^>]*>/gi)].map(m => parseInt(m[1].slice(1)));
  let flowOk = true;
  for (let i = 1; i < headings.length; i++) {
    if (headings[i] - headings[i-1] > 1) { flowOk = false; break; }
  }

  const faqItems = [...html.matchAll(/<(dt|\.faq-q|question)[^>]*>/gi)].length +
    [...html.matchAll(/class="[^"]*faq[^"]*"/gi)].length / 2;

  const secKwUsed = secKeywords.every(sk => bodyText.includes(sk.toLowerCase()));

  return {
    titleLen,
    metaLen,
    metaHasKw: metaText.toLowerCase().includes(kwLower),
    h1Count: h1s.length,
    h1HasKw: h1s.some(m => m[1].toLowerCase().includes(kwLower)),
    h2Count: h2s.length,
    firstParaHasKw: firstPara.includes(kwLower),
    hasCanonical: /CANONICAL URL:/i.test(html),
    hasSchema: /<script[^>]*application\/ld\+json/i.test(html),
    hasFaqSchema: /FAQPage/i.test(html),
    hasBreadcrumb: /BreadcrumbList/i.test(html),
    imgsMissingAlt: altMissing,
    hasOg: /og:title/i.test(html),
    hasTwitter: /twitter:card/i.test(html),
    wordCount: bodyText.split(/\s+/).length,
    internalLinks: (html.match(/href="[^"]*#[^"]+"/gi) || []).length,
    faqCount: Math.max(faqItems, (html.match(/<\/summary>|class="faq-answer"/gi) || []).length),
    headingFlowOk: flowOk,
    secKwUsed: secKeywords.length === 0 || secKwUsed,
    hasStyle: /<style/i.test(html),
  };
}

function renderSEOScore(d) {
  let pass = 0;
  const list = document.getElementById('rulesList');
  list.innerHTML = SEO_RULES.map(rule => {
    const ok = rule.check(d);
    if (ok) pass++;
    return `<div class="rule-row ${ok ? 'pass' : 'fail'}">
      <div class="rule-dot"></div>
      <span>${rule.label}</span>
      <span style="margin-left:auto;font-family:var(--mono);font-size:10px;">${ok ? '✓' : '✗'}</span>
    </div>`;
  }).join('');

  const score = Math.round((pass / SEO_RULES.length) * 100);
  const circle = document.getElementById('scoreCircle');
  const circ = 175.9;
  circle.style.strokeDashoffset = circ - (circ * score / 100);

  let color = '#dc2626';
  if (score >= 80) color = '#16a34a';
  else if (score >= 60) color = '#d97706';
  else if (score >= 40) color = '#2563eb';
  circle.style.stroke = color;

  document.getElementById('scoreNum').textContent = score;
  document.getElementById('scoreLabel').textContent = score >= 80 ? 'Excellent' : score >= 60 ? 'Good' : score >= 40 ? 'Needs Work' : 'Poor';
  document.getElementById('scoreSubLabel').textContent = `${pass} of ${SEO_RULES.length} rules passing`;
  document.getElementById('seoScoreBadge').textContent = `SEO ${score}/100`;
}

function renderRulesList() {
  const list = document.getElementById('rulesList');
  list.innerHTML = SEO_RULES.map(rule => `
    <div class="rule-row" id="rule-${rule.id}">
      <div class="rule-dot"></div>
      <span>${rule.label}</span>
    </div>
  `).join('');
}

// ─── RESULT TABS ───
function switchRTab(id, btn) {
  document.querySelectorAll('.rtab').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.rtab-panel').forEach(p => p.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('rp-' + id).classList.add('active');
}

// ─── DOWNLOAD / COPY ───
function downloadPage() {
  if (!generatedHTML) return;
  const kw = document.getElementById('focusKeyword').value.trim().toLowerCase().replace(/\s+/g,'-') || 'page';
  const blob = new Blob([generatedHTML], { type: 'text/html' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `${kw}-seo-page.html`;
  a.click();
  showToast('success', 'Downloaded!');
}

function copyCode() {
  if (!generatedHTML) return;
  navigator.clipboard.writeText(generatedHTML).then(() => {
    showToast('success', 'Copied to clipboard!');
  });
}

function openInNew() {
  if (!generatedHTML) return;
  const blob = new Blob([generatedHTML], { type: 'text/html' });
  window.open(URL.createObjectURL(blob), '_blank');
}

// ─── TOAST ───
function showToast(type, msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = `toast ${type} show`;
  clearTimeout(t._timer);
  t._timer = setTimeout(() => t.classList.remove('show'), 3500);
}
</script>
</body>
</html>
